<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Status Page Monitor</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: #0d1117;
            color: #c9d1d9;
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        #header {
            background: #161b22;
            border-bottom: 1px solid #30363d;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #header h1 {
            font-size: 16px;
            font-weight: 600;
            color: #58a6ff;
        }

        #status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }

        #status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #f85149;
        }

        #status-dot.connected { background: #3fb950; }
        #status-dot.reconnecting { background: #d29922; }

        #log {
            flex: 1;
            overflow-y: auto;
            padding: 16px 20px;
        }

        .event {
            margin-bottom: 12px;
            padding: 10px 14px;
            border-left: 3px solid #30363d;
            background: #161b22;
            border-radius: 0 4px 4px 0;
        }

        .event.new { border-left-color: #3fb950; }
        .event.updated { border-left-color: #d29922; }

        .event-header {
            display: flex;
            gap: 10px;
            margin-bottom: 4px;
        }

        .event-time { color: #8b949e; }

        .event-tag {
            font-weight: bold;
            font-size: 12px;
            padding: 1px 6px;
            border-radius: 3px;
        }

        .event-tag.new { background: #238636; color: #fff; }
        .event-tag.updated { background: #9e6a03; color: #fff; }

        .event-provider { color: #58a6ff; font-weight: bold; }
        .event-product { color: #c9d1d9; }
        .event-status { color: #8b949e; margin-top: 2px; }

        #empty-state {
            color: #484f58;
            text-align: center;
            margin-top: 40px;
        }
    </style>
</head>
<body>
    <div id="header">
        <h1>Status Page Monitor</h1>
        <div id="status">
            <div id="status-dot"></div>
            <span id="status-text">Connecting...</span>
        </div>
    </div>
    <div id="log">
        <div id="empty-state">Waiting for events...</div>
    </div>

    <script>
        const log = document.getElementById('log');
        const dot = document.getElementById('status-dot');
        const statusText = document.getElementById('status-text');
        const emptyState = document.getElementById('empty-state');

        const source = new EventSource('/events');

        source.onopen = function () {
            dot.className = 'connected';
            statusText.textContent = 'Connected';
        };

        source.onerror = function () {
            dot.className = 'reconnecting';
            statusText.textContent = 'Reconnecting...';
        };

        source.onmessage = function (e) {
            if (emptyState) emptyState.remove();

            const event = JSON.parse(e.data);
            const type = event.event_type;
            const tag = type === 'updated' ? 'UPDATED' : 'NEW';
            const ts = event.timestamp.replace('T', ' ').substring(0, 19);

            const div = document.createElement('div');
            div.className = 'event ' + type;
            div.innerHTML =
                '<div class="event-header">' +
                    '<span class="event-time">[' + ts + ']</span>' +
                    '<span class="event-tag ' + type + '">' + tag + '</span>' +
                    '<span class="event-provider">' + event.provider + '</span>' +
                '</div>' +
                '<div class="event-product">Product: ' + event.product + '</div>' +
                '<div class="event-status">Status: ' + event.status +
                    (event.message ? ' â€” ' + event.message.substring(0, 200) : '') +
                '</div>';

            log.appendChild(div);
            log.scrollTop = log.scrollHeight;
        };
    </script>
</body>
</html>
